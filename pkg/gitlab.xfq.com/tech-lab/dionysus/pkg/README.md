# PKG 开发规范

## PKG 目标
我们希望pkg可以作为承载我们 http 、grpc 服务框架的基础组件库，库内组件相互独立没有强依赖，从而减轻上层框架复杂度。
处于稳定状态，且适用范围较广的包，会移动到 [ngkit](https://gitlab.xfq.com/tech-lab/ngkit)

类似 [go-kit](https://gokit.io/faq/) 是一个筛选后的工具集，我们希望在 pkg 中没有选择，每个包都经过良好设计，组件的基础参数都已经验证且有最佳值。

```      
+------------------------------------------------------+
|                                                      |
|                    business system                   |
|                                                      |
+------------------------------------------------------+
+-----------------+  +--------------+  +---------------+
|                 |  |              |  |               |
|     micro       |  |    gin       |  |     ctl       |
|                 |  |              |  |               |
+-----------------+  +--------------+  +---------------+
+-------+  +-------+ +-----+ +----------+ +-----+ +----+
|       |  |       | |     | |          | |     | |    |
|       |  |       | |     | |          | |     | |    |
| redis |  | mysql | | nsq | | rabbitmq | | log | | .. |
|       |  |       | |     | |          | |     | |    |
|       |  |       | |     | |          | |     | |    |
+-------+  +-------+ +-----+ +----------+ +-----+ +----+

```

## 设计约束

#### 1. 依赖处理
对外部的依赖只能依赖接口，每个接口的定义、默认实现和 set 方法都必须放在同名文件中。
```go
// log.go
type logger interface{
    Info()
    Error()
}

var log logger=zap.New()

Set(l logger){
    log=l
}
```
   
#### 2. 编码
请参照 https://github.com/uber-go/guide/blob/master/style.md
    
#### 3. 测试
单元测试应该覆盖 **所有流程分支的组合**，覆盖率大于 90%。

## 开发流程
1. 新建所属 pkg 目录
2. 编码、测试。测试如需其他服务支持，[请修改 docker-image](../README.md#测试镜像制作说明)
3. 编写使用帮助
4. 提交 mr，进入review阶段
5. review 通过，合并到 master ，打 tag，写 [发布说明](https://keepachangelog.com/zh-CN/1.0.0/)